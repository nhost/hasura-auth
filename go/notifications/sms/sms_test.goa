package sms_test

import (
	"os"
	"testing"

	"github.com/nhost/hasura-auth/go/notifications"
)

func TestSendSMS(t *testing.T) {
	t.Parallel()

	cases := []struct {
		name        string
		from        string
		to          string
		body        string
		expectError bool
	}{
		{
			name:        "succes",
			from:        "+15005550006",
			to:          "+46091321243",
			body:        "Hello, this is a test message!",
			expectError: false,
		},
		{
			name:        "succes",
			from:        "+15005550001",
			to:          "+46091321243",
			body:        "Hello, this is a test message!",
			expectError: true,
		},
	}

	twcl := notifications.NewTwilioSMS(
		os.Getenv("TWILIO_ACCOUNT_SID"),
		os.Getenv("TWILIO_AUTH_TOKEN"),
		os.Getenv("TWILIO_MESSAGE_SERVICE_SID"),
	)

	for _, tc := range cases {
		t.Run(tc.name, func(t *testing.T) {
			t.Parallel()

			err := twcl.SendSMS(tc.to, tc.body)
			if err != nil && !tc.expectError {
				t.Errorf("failed to send SMS: %v", err)
			}
			if err == nil && tc.expectError {
				t.Errorf("expected an error but got none")
			}
		})
	}
}
